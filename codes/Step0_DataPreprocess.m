% Script generated by Brainstorm (08-Mar-2016)

% Input files
sFiles = [];
SubjectNames = {...
    'rsvp_08'};
RawFiles = {...
    '/dataslow/sheng/rsvp/rawdata/rsvp_08/160321/rsvp08_tsss_mc.fif',
    '/dataslow/sheng/rsvp/rawdata/rsvp_08/160321/rsvp08-1_tsss_mc.fif',
    '/dataslow/sheng/rsvp/rawdata/rsvp_08/160321/rsvp08-2_tsss_mc.fif'};

for i_RawFile = 1:3
    for i_speed = 1:2
        % Start a new report
        bst_report('Start', sFiles);

        % Process: Create link to raw file
        sFiles = bst_process('CallProcess', 'process_import_data_raw', sFiles, [], ...
            'subjectname', SubjectNames{1}, ...
            'datafile', {RawFiles{i_RawFile}, 'FIF'}, ...
            'channelreplace', 1, ...
            'channelalign', 0, ...
            'evtmode', 'value');

        % Process: Read from channel
        sFiles = bst_process('CallProcess', 'process_evt_read', sFiles, [], ...
            'stimchan', 'STI101', ...
            'trackmode', 1, ...  % Value: detect the changes of channel value
            'zero', 0);

        % Process: Detect eye blinks
        sFiles = bst_process('CallProcess', 'process_evt_detect_eog', sFiles, [], ...
            'channelname', 'MISC007', ...
            'timewindow', [], ...
            'eventname', 'blink');

        % Process: SSP EOG: blink
        sFiles = bst_process('CallProcess', 'process_ssp_eog', sFiles, [], ...
            'eventname', 'blink', ...
            'sensortypes', 'MEG', ...
            'usessp', 1, ...
            'select', 1);
        
        if i_speed == 1
            % Process: Import MEG/EEG: Events
            sFiles = bst_process('CallProcess', 'process_import_data_event', sFiles, [], ...
                'subjectname', SubjectNames{1}, ...
                'condition', '101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124', ...
                'eventname', '101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124', ...
                'timewindow', [], ...
                'epochtime', [-0.359, 0.928], ...
                'createcond', 1, ...
                'ignoreshort', 1, ...
                'usectfcomp', 1, ...
                'usessp', 1, ...
                'freq', [], ...
                'baseline', [-0.359, -0.060]);
        else
            % Process: Import MEG/EEG: Events
            sFiles = bst_process('CallProcess', 'process_import_data_event', sFiles, [], ...
                'subjectname', SubjectNames{1}, ...
                'condition', '201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224', ...
                'eventname', '201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224', ...
                'timewindow', [], ...
                'epochtime', [-0.444, 1.030], ...
                'createcond', 1, ...
                'ignoreshort', 1, ...
                'usectfcomp', 1, ...
                'usessp', 1, ...
                'freq', [], ...
                'baseline', [-0.444, -0.145]);
        end
        
        % Process: Detect bad trials: Peak-to-peak  MEGGRAD(0-6000) MEGMAG(0-6000)
        sFiles = bst_process('CallProcess', 'process_detectbad', sFiles, [], ...
            'timewindow', [], ...
            'meggrad', [0, 6000], ...
            'megmag', [0, 6000], ...
            'eeg', [0, 0], ...
            'eog', [0, 0], ...
            'ecg', [0, 0], ...
            'rejectmode', 2);  % Reject the entire trial

        % Process: Add time offset: -26.00ms
        sFiles = bst_process('CallProcess', 'process_timeoffset', sFiles, [], ...
        'info', [], ...
        'offset', -0.026, ...
        'overwrite', 1);

        % Save and display report
        ReportFile = bst_report('Save', sFiles);
        bst_report('Open', ReportFile);
   end
end
